# Первичный анализ данных и система рекомендаций для клиентов H&M

## Введение

Основное внимание в этом проекте уделяется первичному анализу данных и разработке системы персонализированных рекомендаций для клиентов H&M. Анализ выполняется с использованием Python и включает в себя обширный разведочный анализ данных (EDA) и начальный анализ данных (IDA).

## Как запустить проект
- Склонируйте репозиторий на свой локальный компьютер:
```sh
git clone https://github.com/your-username/your-repository.git
```
- Данные для анализа:
Данные слишком велики для хранения на GitHub. В проекте используются прямые ссылки на 3 файла с данными на мой Google Диск: ArticlesHM, CustomersHM и TransactionsHM.
- Откройте ноутбуки:
Откройте ноутбуки в папке /notebooks через Google Colab или Jupyter Notebook для просмотра и выполнения кода.
- Установите необходимые зависимости с помощью команды:
```sh
pip install -r requirements.txt
```
(Предполагается, что вы создали файл requirements.txt со списком всех необходимых библиотек).

**Пример кода для доступа к данным на Google Диске в Google Colab**
```python
from pydrive.auth import GoogleAuth
from pydrive.drive import GoogleDrive
from google.colab import auth
from oauth2client.client import GoogleCredentials
import pandas as pd

# Аутентификация и авторизация
auth.authenticate_user()
gauth = GoogleAuth()
gauth.credentials = GoogleCredentials.get_application_default()
drive = GoogleDrive(gauth)

# Загрузка файлов с Google Диска
file_ids = {
    'articles': '1H-g4oAbw1ZjYDOncx3xU3oro3tH3UIg6',
    'customers': '1KLM7Vum2O35MR17ULRLneM0uGVX61-VR',
    'transactions': '18ESMoz4VDe_ZCZzRPKKZS-UargXvrRdi'
}

for name, file_id in file_ids.items():
    downloaded = drive.CreateFile({'id': file_id})
    downloaded.GetContentFile(f'{name}.csv')
    print(f'{name}.csv downloaded')

# Чтение данных в DataFrame
df_articles = pd.read_csv('articles.csv')
df_customers = pd.read_csv('customers.csv')
df_transactions = pd.read_csv('transactions.csv')

# Отображение первых строк каждого DataFrame
print(df_articles.head())
print(df_customers.head())
print(df_transactions.head())
```
## Цели и задачи
### Цели
### Задачи
1. **Сбор и предобработка данных**
2. **Анализ данных**
3.  **Визуализация данных**
4.  
## Подробная методология
### Инструменты и библиотеки

В данном проекте использовались следующие инструменты и библиотеки:
- **Python:** Основной язык программирования, используемый для анализа данных и построения моделей.

- **Pandas:** Библиотека для обработки и анализа данных. Использовалась для работы с датафреймами.

- **NumPy:** Библиотека для работы с массивами и выполнения численных вычислений.

- **Seaborn:** Библиотека для визуализации данных, основанная на matplotlib. Использовалась для создания статистических графиков.

- **Matplotlib:** Основная библиотека для создания графиков и визуализации данных.
  
- **Squarify:** Библиотека для создания трематических диаграмм (treemaps).

- **textwrap:** Библиотека для оборачивания текста в строках, чтобы текст помещался в заданные границы.

- **Plotly:** Библиотека для интерактивной визуализации данных.

### Сбор и предобработка данных
**Источник данных:**
  Данные для этого проекта взяты c https://www.kaggle.com/competitions/h-and-m-personalized-fashion-recommendations
  
**Структура базы данных:**
  База данных представлена в виде трех файлов: ArticlesHM, CustomersHM и TransactionsHM. 
  **ArticlesHM** - это таблица, которая содержит все артикулы H&M, а именно **105 542 строк**, включая следующие колонки:
  - **article_id:** id товара, тип данных - int64
  - **prod_name:** название товара, тип данных - object
  - **product_type_name:** название типа товара, тип данных - object
  - **product_group_name:** название группы товара, тип данных - object
  - **graphical_appearance_name:** название рисунка товара, тип данных - object
  - **colour_group_name:** название группы цвета, тип данных - object
  - **index_name:** название раздела, тип данных - object
  - **index_group_name:** название группы разделов, тип данных - object
  - **section_name:** название секции, тип данных - object
  - **garment_group_name:** категория товара, тип данных - object
  - **detail_desc:** детали, тип данных - object

**CustomersHM** - это таблица, которая содержит информацию о клиентах H&M, а именно **1 371 979 строк**, включая следующие колонки:
  - **customer_id:** id клиента, тип данных - object
  - **Active:** , тип данных - float64
  - **club_member_status :** статус в клубе, тип данных - object
  - **fashion_news_frequency:** подписка на новости (частота), тип данных - object
  - **age:** возраст клиента, тип данных - float64
  - **postal_code:** почтовый индекс, тип данных - object

**TransactionsHM** - это таблица, которая содержит информацию о продажах H&M, а именно **31 788 323 строк**, включая следующие колонки:
  - **t_dat:** дата продажи, тип данных - object
  - **customer_id:** id клиента, тип данных - object
  - **article_id:** id товара, тип данных - int64
  - **price :** цена товара, тип данных - float64
  - **sales_channel_id:** канал продажи, тип данных - int64

#### Оптимизация данных

DataFrme **df_articles** требует следующей оптимизации:

1. **Преобразование столбца `article_id` в `int32`:**
   - Уменьшение объема памяти за счет использования 32-битного целого числа вместо 64-битного. Это позволяет экономить память при хранении целочисленных данных. Минимальное значение article_id - 108 775 015, а максимальное значение - 959 461 001 находятся в пределах диапазона int32 (-2 147 483 648 до 2 147 483 647).

2. **Преобразование всех десяти строковых столбцов `prod_name`, `product_type_name`, `product_group_name`, `graphical_appearance_name`, `colour_group_name`, `index_name`, `index_group_name`, `section_name`, `garment_group_name`, `detail_desc`  из `object` в `category`:**
    - Столбцы с текстовыми значениями могут занимать много места. Если столбцы содержат повторяющиеся значения, как в нашем случае, лучше преобразовать их в категориальные данные, чтобы сократить использование памяти.

Эти преобразования позволили уменьшить объем памяти, используемый DataFrame `df_article`, с **8.9 MB** до оптимизации до **4.8 MB** после оптимизации. Это существенно улучшит производительность при работе с этим DataFrame.

DataFrame **df_customers** требует следующей оптимизации:

1. **Преобразование столбца `Active` в `bool`:**
   - Мы выяснили, что `Active` принимает только одно значение - 1, но большинство значений - NaN. Поэтому преобразование этого столбца из float64 в bool оправдано и позволяет значительно оптимизировать наши данные

2. **Преобразование столбца `customer_id` в категориальный тип данных (`category`):**
    - Это преобразование необходимо провести, чтобы синхронизировать наши данные с df_transactions, в котором `customer_id` в категориальный тип данных было необходимо для значительного сокращения объема памяти.

3. **Преобразование столбцов `club_member_status` и `fashion_news_frequency`  из `object` в категориальный тип данных (`category`):**
    - Оба столбца принимают достаточно ограниченное количество значений, а именно - по 3. `fashion_news_frequency` могло быть 'NONE', 'Regularly', 'Monthly', а `club_member_status`: 'ACTIVE', 'PRE-CREATE', 'LEFT CLUB'. Поэтому преобразование  из `object` необходимо в данном случае

4. **Преобразование столбца `age` из  `float64` в `uint8`:**
    - Столбец `age` принимает значения от 0 до 99, поэтому целесобразно преобразование в тип данных uint8, который используется в диапазоне от 0 до 255.

Сравнение различных вариантов оптимизации показало, что преобразование всех строковых столбцов в категориальные данные (category) не всегда приводит к значительному уменьшению использования памяти. Иногда использование object для некоторых столбцов может быть более эффективным и именно поэтому тип данных столбца `postal_code` не был изменен и в данном случае использование типа данных object оказалось оптимальным. В целом все преобразования не позволили уменьшить объем памяти, используемый DataFrame `df_customers`, с **62.8 GB** до оптимизации до **63.7 MB** после оптимизации. Но такое впечатление достаточно поверхностное, во-первых обьем памяти остался прежним, новые тивы данных позволяют более эффективно обрабатывать данные и нужно учитывать, что основной "утяжелитель" оптимизируемого датафрейма - это преобразованный `customer_id`, но это была вынужденная мера для синхронизации типов данных с df_transactions, в котором преобразование `customer_id` в категориальный тип было просто необходимостью.

DataFrame **df_transactions**, представляет собой очень большой объем информации и требует следующей дополнительной оптимизации:

1. **Преобразование столбца `t_dat` в `datetime64[ns]`:**
   - Экономия памяти за счет использования более эффективного формата для дат, который уменьшает объем хранимых данных по сравнению с типом `object`.

2. **Преобразование столбца `customer_id` в категориальный тип данных (`category`):**
   - Значительное уменьшение объема памяти, так как категориальные данные хранятся в виде кодов вместо строк, что существенно сокращает объем памяти, необходимый для хранения строковых данных. Количество уникальных значений в customer_id составляет 1 362 281 при общем количестве записей 31 788 324, что указывает на то, что преобразование столбца в категориальный тип данных может быть полезным для уменьшения объема памяти.

3. **Преобразование столбца `article_id` в `int32`:**
   - Уменьшение объема памяти за счет использования 32-битного целого числа вместо 64-битного. Это позволяет экономить память при хранении целочисленных данных. Минимальное значение article_id - 108 775 015, а максимальное значение - 956 217 002 находятся в пределах диапазона int32 (-2 147 483 648 до 2 147 483 647).

4. **Преобразование столбца `price` в `float32`:**
   - Уменьшение объема памяти за счет использования 32-битного числа с плавающей запятой вместо 64-битного. Это особенно полезно для числовых данных, где высокая точность не требуется.

5. **Преобразование столбца `sales_channel_id` в `int8`:**
   - Минимизация объема памяти для этого столбца за счет использования 8-битного целого числа. Поскольку уникальных значений в столбце sales_channel_id всего два (1 и 2), это преобразование эффективно.

Эти преобразования позволили значительно уменьшить объем памяти, используемый DataFrame `df_transactions`, с **1.2 GB** до оптимизации до **679.3 MB** после оптимизации, что улучшает общую производительность системы при работе с большими объемами данных.

**Примеры данных**
Группы продуктов:
```python
product_group_name
Garment Upper body       42741
Garment Lower body       19812
Garment Full body        13292
Accessories              11158
Underwear                 5490
Shoes                     5283
Swimwear                  3127
Socks & Tights            2442
Nightwear                 1899
Unknown                    121
Underwear/nightwear         54
Cosmetic                    49
Bags                        25
Items                       17
Furniture                   13
Garment and Shoe care        9
Stationery                   5
Interior textile             3
Fun                          2
```
Примеры типов продуктов в группе "Accessories":
```python
product_group_name     product_type_name       
Accessories            Accessories set                 7
                       Alice band                      6
                       Baby Bib                        3
                       Bag                          1280
                       Beanie                         56
                       Belt                          458
                       Bracelet                      180
                       Braces                          3
                       Bucket hat                      7
                       Cap                            13
                       Cap/peaked                    573
                       Dog Wear                       20
                       Earring                      1159
                       Earrings                       11
                       Eyeglasses                      2
                       Felt hat                       10
                       Giftbox                        15
                       Gloves                        367
                       Hair clip                     244
                       Hair string                   238
                       Hair ties                      24
                       Hair/alice band               854
                       Hairband                        2
                       Hat/beanie                   1349
                       Hat/brim                      396
                       Headband                        1
                       Necklace                      581
                       Other accessories            1034
                       Ring                          240
                       Scarf                        1013
                       Soft Toys                      46
                       Straw hat                       6
                       Sunglasses                    621
                       Tie                           141
                       Umbrella                       26
                       Wallet                         77
                       Watch                          73
                       Waterbottle                    22
```
Секции продуктов и их разделы
```python
index_group_name  index_name                      section_name                  
Baby/Children     Baby Sizes 50-98                Baby Boy                          1717
                                                  Baby Essentials & Complements     4932
                                                  Baby Girl                         1760
                                                  Kids & Baby Shoes                  457
                                                  Kids Local Relevance                 9
                  Children Accessories, Swimwear  Kids & Baby Shoes                 1685
                                                  Kids Accessories, Swimwear & D    1731
                                                  Kids Outerwear                    1199
                  Children Sizes 134-170          Boys Underwear & Basics            842
                                                  Girls Underwear & Basics          1485
                                                  Kids Outerwear                     636
                                                  Young Boy                         2352
                                                  Young Girl                        3899
                  Children Sizes 92-140           Boys Underwear & Basics           1192
                                                  Girls Underwear & Basics          2005
                                                  Kids Boy                          3328
                                                  Kids Girl                         4469
                                                  Kids Local Relevance               183
                                                  Kids Outerwear                     830
Divided           Divided                         Divided Accessories               1732
                                                  Divided Asia keys                  280
                                                  Divided Basics                    1723
                                                  Divided Collection                7124
                                                  Divided Complements Other           35
                                                  Divided Projects                  2364
                                                  Divided Selected                   991
                                                  EQ Divided                          26
                                                  Ladies Denim                       874
Ladieswear        Ladies Accessories              Womens Big accessories            1665
                                                  Womens Shoes                      2026
                                                  Womens Small accessories          3270
                  Ladieswear                      Collaborations                     559
                                                  H&M+                              2337
                                                  Ladies Denim                       227
                                                  Ladies Other                         4
                                                  Mama                              2266
                                                  Special Collections                682
                                                  Womens Casual                     2725
                                                  Womens Everyday Basics            1581
                                                  Womens Everyday Collection        7295
                                                  Womens Jackets                     829
                                                  Womens Nightwear, Socks & Tigh     228
                                                  Womens Premium                    1270
                                                  Womens Tailoring                  3376
                                                  Womens Trend                      2622
                  Lingeries/Tights                Womens Lingerie                   3598
                                                  Womens Nightwear, Socks & Tigh    1338
                                                  Womens Swimwear, beachwear        1839
Menswear          Menswear                        Contemporary Casual               1560
                                                  Contemporary Smart                1778
                                                  Contemporary Street               1490
                                                  Denim Men                          521
                                                  Men Accessories                   1337
                                                  Men Edition                        330
                                                  Men Other                           25
                                                  Men Other 2                        190
                                                  Men Project                        298
                                                  Men Shoes                          645
                                                  Men Suits & Tailoring             1428
                                                  Men Underwear                     2322
                                                  Mens Outerwear                     629
Sport             Sport                           Kids Sports                        626
                                                  Ladies H&M Sport                  1894
                                                  Men H&M Sport                      872
```
### Анализ и визуализация данных

**Распределение товаров по группам продуктов**

Всего база данных содержит 19 групп продуктов. Наибольшее количество товаров принадлежит группе "Garment Upper body", что составляет 40.5% всех товаров. Самые малочисленные группы: "Nightwear", "Unknown", "Underwear/nightwear", 
"Cosmetic", "Bags", "Items", "Furniture", "Garment and Shoe care", "Stationery", "Interior textile", "Fun". Все малочисленные группы отображены в "Other" на визуализации.
![Разделение на различные группы товаров](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ProductGroupPie.png)

 **Распределение товаров по типам продуктов внутри каждой группы**
 
Каждая из 19 групп имеет дополнительно разделение по типам продуктов. Больше всего различных типов продуктов находится в группе "Accessories". Примеры типов продуктов в группе "Accessories" представлен в разделе выше. Распределение трех самых больших групп "Garment Full body", "Garment Lower body" и "Garment Upper body" по типам продуктов показано на столбчатой диаграмме ниже.
![РаспределениеПоТипамПродуктовДляТрехГруппТоваров](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ProductTypesIn3Groups.png)

**Распределение товаров по типам принтов**

Анализ типов принтов показывает, какие принты наиболее распространены среди товаров. Всего база данных содержит 30 разных принтов. Из диаграммы видно, что самый популярный принт - "Solid", который составляет 47.1% всех товаров. Самые редкие принты объединены в группу "Other".
![РаспределениеПоТипуПринтов](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ProductDruckePie.png)

**Распределение товаров по цвету**

Из 50 различных цветов самым распространенным является черный цвет. Для лучшей наглядности следующей визуализации был создан словарь цветов и использована библиотека squarify.
![РаспределениеТоваровПоЦветам](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ProductColorsTreemap.png)

**Распределение товаров по разделам**

Еще одна важная визуализация показывает, как товары распределены по разделам. Это помогает понять, какие товары более популярны. Из диаграммы видно, что раздел "Ladieswear" составляет наибольшую долю, равную 24.6%. Второй по величине раздел "Divided" это молодежная и более дешевая одежда.
![РаспределениеТоваровПоКатегориям](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ProductIndexPie.png)

**Распределение товаров по секциям и разделам внутри групп разделов**

Дополнительно некоторые разделы объединены в группы и и каждый раздел содержит секции товаров. В разделе "Структура базы данных" приведен пример данных в виде списка всех секций с разделением их по разделам и группам разделов. Ниже представлена sunburst диаграмма, которая это разделение визуализирует. 
![РаспределениеПоСекциямВнутриГруппКатегорий](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ProductSectionsInCategories.png)

**Распределение товаров по секциям и категориям внутри группы категорий "Ladieswear"**

Из диаграммы выше мы видим, что только две группы категории имеют дальнейшее разделение на несколько категорий, каждая из которых имеет свои секции. Это группы категорий "Ladieswear" и "Baby/Children". И эти две группы категории я визуализирую каждую отдельно.
![РаспределениеПоСекциямВнутриLadieswear](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ProductSectionsInLadieswear.png)

**Распределение товаров по секциям и категориям внутри группы категорий "Baby/Children"**

![РаспределениеПоСекциямВнутриBabyChildren](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ProductSectionsInBaby_Children.png)

**Распределение товаров по категориям**

Мы видим, что самая крупная категория "Jersey Fancy", за ней идет категория "Accessories".
![РаспределениеТоваровПоКатегориям](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ProductGarmentPie.png)

**Распределение клиентов по их статусу в клубе**

Большая часть клиентов являются членами клуба (92.7%), около 6.8% находятся в стадии оформления членства в клубе, и очень маленькая доля — 0.0003% (467 клиентов) покинула клуб. Эта группа была объединена в категорию "Other" вместе с неопределенными значениями.

![РаспределениеКлиентовПоСтатусуВКлубе](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ClubStatusClientPie.png)

**Анализ частоты отправки новостей клиентам**

Чуть больше трети клиентов (34.8%) подписаны на регулярные новости, 0.1% получают новости ежемесячно. Большая часть клиентов (65.1%) вообще не имеют подписки. Это достаточно значительная доля, и следует предпринимать шаги для её сокращения. Важно, чтобы рассылка новостей не превращалась в спам, а представляла собой что-то связанное с модой, вызывающее интерес к просмотру, и, в идеале, приводящее к переходу на сайт компании и совершению покупок.

![РаспределениеЧастотыОтправкиНовостейКлиентам](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/FashionNewsFrequencytPie.png)

**Визуализация распределения возраста клиентов**

Гистограмма показывает два основных возрастных пика среди покупателей:

- Первый пик наблюдается в районе 21 года.
- Второй пик — около 50 лет.
  
Также виден спад активности в промежутке около 40 лет. Это может быть интересной областью для детального анализа. Например, стоит рассмотреть, какие группы товаров покупают клиенты этой возрастной группы, в какое время они совершают покупки, и как часто они получают рассылки. Понимание этих факторов может помочь выявить причины снижения активности в этой возрастной группе.

Кроме того, гистограмма показывает достаточно длинный хвост в сторону более возрастных клиентов, что указывает на наличие значительного числа пожилых покупателей. Это важно учитывать при разработке маркетинговых стратегий, так как они представляют собой значимую группу клиентов.

![РаспределениеВозрастаКлиентовСПомощьюГисторгаммы](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ClientsAgeHistogramm.png)

Ящичная диаграмма (BoxPlot) показывает:

- Медиана возрастного распределения составляет 31 год, что указывает на то, что основная группа клиентов — молодежь.
- Первый квантиль (25%) охватывает возрастную группу с 24 до 31 года.
- Третий квантиль (75%) охватывает возрастную группу с 31 до 49 лет, что значительно шире, чем возрастная группа второго квантиля.
    
Этот анализ еще раз подчеркивает важность группы клиентов третьего квантиля и необходимость дополнительного анализа и действий со стороны компании для удовлетворения потребностей этой группы.

![РаспределениеВозрастаКлиентовСПомощьюКвадратичногоЯщика](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ClientsAgeBoxPlot.png)

**Распределение подписки клиентов на новости по квантилям**

Предыдущая ящичная диаграмма показала необходимость дополнительного анализа клиентов по возрастным квантилям. В первую очередь нас интересует третий квантиль и спад активности клиентов этой возрастной группы. На следующей столбчатой диаграмме мы наблюдаем, что все группы распределены приблизительно одинаково с незначительными отличиями.

Наименьший процент подписки на новости имеет самая активная группа клиентов в возрасте 24-31 года. Есть смысл поработать с этой группой дополнительно, повысив её интерес к подписочным материалам, а также дополнительно изучив потребности данной группы. Это же касается и клиентов третьего квантиля.

![РаспределениеПодпискиКлиентовНаНовостиПоКвантилям](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/FashionNewsFrequencyAgeQuartile.png)

**Распределение активного статуса клиентов по квантилям**

На следующей диаграмме показано распределение активных клиентов по возрастным квантилям. Видно, что процент активных клиентов также распределен достаточно равномерно среди всех квантилей, однако все еще существуют небольшие различия, которые можно изучить и использовать для повышения активности в каждой возрастной группе.

![РаспределениеАктивногоСтатусаКлиентовПоКвантилям](https://github.com/OlhaAD/EDA_IDA_H_and_M_Python/blob/main/visualizations/ActiveStatusAgeQuartile.png)

**Распределение клиентов по почтовым индексам**

Мы видим, что очень большое количество клиентов имеют один и тот же почтовый индекс. Предположу, что этот индекс не имеет ничего общего с физическим индексом клиентов и скорее всего является индексом почтомата или какого-то крупного пункта выдачи заказов

| Index  | Postal Code                                                      | Counts |
|--------|------------------------------------------------------------------|--------|
| 61034  | 2c29ae653a9282cce4151bd87643c907644e09541abc28ae87dea0d1f6603b1c | 120303 |
| 281937 | cc4ed85e30f4977dae47662ddc468cd2eec11472de6fac                   | 261    |
| 156090 | 714976379549eb90aae4a71bca6c7402cc646ae7c40f6c                   | 159    |
| 171208 | 7c1fa3b0ec1d37ce2c3f34f63bd792f3b4494f324b6be5                   | 157    |
| 126228 | 5b7eb31eabebd3277de632b82267286d847fd5d44287ee                   | 156    |

На основании анализа данных можно сделать следующие выводы:
- Наибольшее количество товаров принадлежит группе "Garment Upper body".
- Товары также разделены на секции и категории, что позволяет более детально анализировать ассортимент.
- Самая крупная группа по типу товаров это брюки "Trousers", более 11169, за ними идут платья "Dresses" 10362.
- Самый распространенный цвет товаров - черный "Black": 22670 наименований, а самый распространенный принт - однотонный "Solid": 49747 позиций.
- Спад активности клиентов в возрасте около 40 лет и длинный хвост в сторону пожилых клиентов представляют собой важные области для дальнейшего исследования.

### Заключение
Этот проект предоставляет первичный анализ данных и систему персонализированных рекомендаций для клиентов H&M.
